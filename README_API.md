# üï∂Ô∏è API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–∑–≥–ª—è–¥–∞

FastAPI —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–∑–≥–ª—è–¥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç RESTful –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–ø—É—Å–∫–∞/–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–∑–≥–ª—è–¥–∞.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì° **RESTful API**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π
- ‚ö° **Real-time**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–∑–≥–ª—è–¥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üîÑ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ API
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã –∏ FPS
- üìö **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: Swagger UI –∏ ReDoc

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements_api.txt
```

## üèÉ‚Äç‚ôÇÔ∏è –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
python gaze_api.py
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ `http://0.0.0.0:800` (–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)

–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- –û—Å–Ω–æ–≤–Ω–æ–π –∞–¥—Ä–µ—Å: `http://127.0.0.1:8000` –∏–ª–∏ `http://localhost:8000`
- Swagger UI: `http://127.0.0.1:800/docs` –∏–ª–∏ `http://localhost:8000/docs`
- ReDoc: `http://127.0.0.1:8000/redoc` –∏–ª–∏ `http://localhost:8000/redoc`

## üåê –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API

### GET /
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–æ—Ä–Ω–µ–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è API

**–û—Ç–≤–µ—Ç**:
```json
{
  "message": "Gaze Tracking API",
  "version": "1.0.0",
  "status": "running"
}
```

### GET /health
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞

**–û—Ç–≤–µ—Ç**:
```json
{
  "status": "healthy",
  "timestamp": 1234567890.123
}
```

### POST /start
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–ø—É—Å–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–∑–≥–ª—è–¥–∞

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞**:
```json
{
  "camera_id": 0
}
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "message": "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∑–≥–ª—è–¥–∞ –∑–∞–ø—É—â–µ–Ω–æ",
  "camera_id": 0,
  "timestamp": 1234567890.123
}
```

### POST /stop
**–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–∑–≥–ª—è–¥–∞

**–û—Ç–≤–µ—Ç**:
```json
{
  "message": "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∑–≥–ª—è–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ",
  "timestamp": 1234567890.123
}
```

### GET /gaze
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–∑–≥–ª—è–¥–∞

**–û—Ç–≤–µ—Ç**:
```json
{
  "x": 0.456,
  "y": 0.789,
  "confidence": 0.85,
  "timestamp": 1234567890.123
}
```

### GET /status
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

**–û—Ç–≤–µ—Ç**:
```json
{
  "is_running": true,
  "fps": 30.5,
  "current_gaze": {
    "x": 0.456,
    "y": 0.789,
    "confidence": 0.85
  },
  "timestamp": 1234567890.123
}
```

## üñ•Ô∏è –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç:

```bash
python api_client_example.py
```

–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º:
1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
2. **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–∑–≥–ª—è–¥–∞

## üåê –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ó–∞–ø—É—Å–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é curl:
```bash
curl -X POST "http://localhost:8000/start" \
     -H "Content-Type: application/json" \
     -d '{"camera_id": 0}'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–∑–≥–ª—è–¥–∞:
```bash
curl -X GET "http://localhost:8000/gaze"
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
```bash
curl -X POST "http://localhost:8000/stop"
```

## üì± –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JavaScript:

```javascript
// –ó–∞–ø—É—Å–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
fetch('http://localhost:8000/start', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({camera_id: 0})
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–∑–≥–ª—è–¥–∞
async function getGazeCoordinates() {
  const response = await fetch('http://localhost:8000/gaze');
  const data = await response.json();
  console.log(`X: ${data.x}, Y: ${data.y}`);
  return data;
}

// –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
setInterval(async () => {
  const gazeData = await getGazeCoordinates();
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–∑–≥–ª—è–¥–∞
}, 100); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 100ms
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –ø–æ–ª–∏—Ç–∏–∫—É –≤ FastAPI
- –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ API —á–µ—Ä–µ–∑ firewall

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (config.py), –≤–∫–ª—é—á–∞—è:
- –ü—É—Ç—å –∫ –º–æ–¥–µ–ª–∏: `checkpoints/gaze_model_best.pth`
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏: `resnet18` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (—Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥—Ä–æ–ø–∞—É—Ç –∏ —Ç.–¥.)

## üê≥ –ó–∞–ø—É—Å–∫ —Å Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Docker:

```Dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements_api.txt .
RUN pip install -r requirements_api.txt

COPY . .

CMD ["python", "gaze_api.py"]
```

```bash
docker build -t gaze-tracking-api .
docker run -p 8000:8000 --device=/dev/video0 gaze-tracking-api
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é API, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.